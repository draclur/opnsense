{% if not helpers.empty('OPNsense.Syslog.destinations.destination') %}
{%    for destination in helpers.toList('OPNsense.Syslog.destinations.destination') %}
{%        set dest_key = destination['@uuid']|replace('-', '')%}
{%        set filters = [] %}

{%        for key in ['program', 'levels', 'facility'] %}
{%            if destination[key] %}
{%                do filters.append("%s(%s)" % (key, destination[key])) %}
{%            endif %}
{%        endfor %}
### log target {{destination['@uuid']}} ####
{%       if filters %}
filter f_{{dest_key}} {
    {{ filters|join(' and ')}}
}
{%       endif %}

destination d_{{dest_key}} {
    network(
        "{{destination.hostname}}"
        transport("{{destination.transport}}")
        port({{destination.port}})
        ip-protocol(4)
    );
};

log {
    source(s_all);
{%       if filters %}
    filter(f_{{dest_key}});
{%       endif %}
    destination(d_{{dest_key}});
};

{%    endfor%}
{% endif %}
